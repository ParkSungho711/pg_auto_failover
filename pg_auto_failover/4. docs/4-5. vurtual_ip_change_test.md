<h1>virtual ip 이전 테스트</h1>

<h3>primary에서 ip 확인</h3>
[~]$ ip a <br>
2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000 <br>
    link/ether 00:50:56:81:c4:74 brd ff:ff:ff:ff:ff:ff <br>
    altname enp11s0 <br>
    inet [primary_IP]/22 brd 192.168.3.255 scope global noprefixroute ens192 <br>
       valid_lft forever preferred_lft forever <br>
    inet 192.168.3.189/32 scope global ens192 <br>
       valid_lft forever preferred_lft forever <br>
    inet6 fe80::250:56ff:fe81:c474/64 scope link noprefixroute <br>
       valid_lft forever preferred_lft forever <br>

<h3>pg_autoctl 상태 확인</h3>
[~]$ pg_autoctl show state <br>
Name |  Node |              Host:Port |       TLI: LSN |   Connection |      Reported State |      Assigned State <br>
-----+-------+------------------------+----------------+--------------+---------------------+-------------------- <br>
 mdw |     1 |   failoverprimary:5432 |  13: 0/451BFC0 |   read-write |             primary |             primary <br>
smdw |    10 | failoversecondary:5432 |  13: 0/451BFC0 |    read-only |           secondary |           secondary <br>

<h3>primary down</h3>
[~]$ sudo systemctl stop pgautofailover.service

<h3>pg_autoctl 상태 확인</h3>
[postgres@failoverprimary ~]$ pg_autoctl show state <br>
Name |  Node |              Host:Port |       TLI: LSN |   Connection |      Reported State |      Assigned State <br>
-----+-------+------------------------+----------------+--------------+---------------------+-------------------- <br>
 mdw |     1 |   failoverprimary:5432 |  13: 0/451BFC0 | read-write ! |             primary |      demote_timeout <br>
smdw |    10 | failoversecondary:5432 |  14: 0/451C1A0 |    read-only |    stop_replication |    stop_replication <br>

<h3>ip 확인</h3>
[postgres@failoverprimary ~]$ ip a
2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:81:c4:74 brd ff:ff:ff:ff:ff:ff
    altname enp11s0
    inet [primary_IP]/22 brd 192.168.3.255 scope global noprefixroute ens192
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:fe81:c474/64 scope link noprefixroute
       valid_lft forever preferred_lft forever

<h3>현재 primary에서 vip확인</h3>
[postgres@failoversecondary ~]$ ip a
2: ens192: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP group default qlen 1000
    link/ether 00:50:56:81:37:d7 brd ff:ff:ff:ff:ff:ff
    altname enp11s0
    inet [secondary_IP]/22 brd 192.168.3.255 scope global noprefixroute ens192
       valid_lft forever preferred_lft forever
    inet 192.168.3.189/32 scope global ens192
       valid_lft forever preferred_lft forever
    inet6 fe80::250:56ff:fe81:37d7/64 scope link noprefixroute
       valid_lft forever preferred_lft forever
